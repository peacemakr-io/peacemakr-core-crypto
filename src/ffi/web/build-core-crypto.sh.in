#!/usr/bin/env bash

set -ex

if [[ ! -z "${EMSDK}" ]]; then
    . ${EMSDK}/emsdk_set_env.sh
else
    echo "Must define EMSDK environment variable"
    exit 1
fi

mkdir -p web-build && pushd web-build
emcmake cmake @SOURCE_CMAKE_DIR@ -DOPENSSL_CRYPTO_LIBRARY=@OPENSSL_LIB_DIR@/libcrypto.a -DOPENSSL_SSL_LIBRARY=@OPENSSL_LIB_DIR@/libssl.a -DOPENSSL_INCLUDE_DIR=@OPENSSL_ROOT_DIR@/include -DPEACEMAKR_BUILD_WEB=ON
emmake make -j
popd
